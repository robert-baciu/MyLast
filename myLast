#!/bin/bash

LOG_FILES="/var/log/auth.log*" 

zcat -f  $LOG_FILES | grep "systemd" | grep -v -e "root" -e "Watching" -e "c1" -e "off" | sort -r | while read ISO_DATE MSG; do
	DATE=$(date -d "$ISO_DATE" "+%a %b %d %H:%M")
	DATE_SECONDS=$(date -d "$ISO_DATE" +%s)
	USER=$(echo $MSG | grep -Eo "user (\w+)" | awk '{print $2}')

	if [[ $MSG == *powering* ]]; then
		END=$DATE_SECONDS
		END_DATE=$DATE
                echo "session closed"
       
	elif [[ $MSG == *seat0* ]]; then
		echo "reboot system boot kernel $DATE - $END_DATE"
	
	# uid(user id) =120 este un cont cu permisiuni limitate creat special pt a rula interfata de login
	elif [[ $MSG == *"uid=120"* ]]; then
		echo "$LAST_USER seat0 login screen $DATE - $END_DATE"

	elif [[ $MSG == *uid* ]]; then
		LAST_USER=$USER
		DIFF=$((END-DATE_SECONDS))
		DURATION=$(date -u -d @"$DIFF" +"%H:%M")
		echo "$USER session opened $DATE - $END_DATE ($DURATION)"
	fi
	

done

